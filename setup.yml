- name: Setup Fedora
  hosts: localhost
  become: yes
  gather_facts: yes

  tasks:
    - name: Configure DNF
      lineinfile:
        path: /etc/dnf/dnf.conf
        line: "{{ item }}"
        create: yes
      loop:
        - "fastestmirror=True"
        - "max_parallel_downloads=10"
        - "defaultyes=True"
        - "keepcache=True"
    - name: Clear cache and update
      shell: |
        dnf -y clean all
        dnf -y update

    - name: Enable RPMFusion
      shell: |
        dnf -y install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm 
        dnf -y groupupdate core 

    - name: Update Hostnames
      hostname: 
        name: endeavour

    - name: Media Codecs
      shell: |
        dnf -y groupupdate multimedia --setop="install_weak_deps=False" --exclude=PackageKit-gstreamer-plugin
        dnf -y groupupdate sound-and-video
    
    - name: install the virtualization package group
      dnf:
        name: '@virtualization'
        state: present

    - name: start and enalbe libvirtd
      systemd:
        state: started
        enalbed: yes

    - name: Install packages with dnf
      dnf:
        name:
          - alacritty
          - fish
          - git 
          - dnf-plugins-core
          - neovim
          - curl 
          - wget 
          - rsync 
          - git-delta
          - duf
          - python-pip
        state: present

    - name: Install brave config
      shell: |
        dnf -y config-manager --add-repo https://brave-browser-rpm-release.s3.brave.com/brave-browser.repo 
        rpm --import https://brave-browser-rpm-release.s3.brave.com/brave-core.asc;

    - name: Install VSCode config 
      shell: |
        rpm --import https://packages.microsoft.com/keys/microsoft.asc
        sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/vscode.repo'
        dnf -y check-update

    - name: Install remaining
      dnf: 
        name:
          - brave-browser
          - code
        state: present

    - name: Install starship
      shell: |
        curl -sS https://starship.rs/install.sh | sh

    - name: Configure starship for fish 
      lineinfile: 
        path: /home/prakhar/.config/fish/config.fish
        line: "{{ item }}"
        create: yes
      loop:
        "starship init fish | source"

    - name: Clone NvChad
      git:
        repo: https://github.com/NvChad/NvChad
        dest: /home/prakhar/.config/nvim 
        depth: 1 

    - name: Clone NvChad config 
      git:
        repo: git@github.com:Prakhar314/NvChad-Config.git
        dest: /home/prakhar/.config/nvim/lua/custom

    - name: Set GNOME wallpaper
      command: gsettings set org.gnome.desktop.background picture-uri 'wallpaper.png'

    - name: Install GNOME extensions
      command: gnome-extensions install Vitals@CoreCoding.com\
        no_activities@yaya.cout\
        sp-tray@sp-tray.esenliyim.github.com\
        spotify-controller@koolskateguy89\
        gsconnect@andyholmes.github.io\
        custom-accent-colors@demiskp\
        user-theme@gnome-shell-extensions.gcampax.github.com\
        GPU_profile_selector@lorenzo9904.gmail.com\
        apps-menu@gnome-shell-extensions.gcampax.github.com\
        background-logo@fedorahosted.org\
        launch-new-instance@gnome-shell-extensions.gcampax.github.com\
        places-menu@gnome-shell-extensions.gcampax.github.com\
        window-list@gnome-shell-extensions.gcampax.github.com\
        pop-shell@system76.com\
        appindicatorsupport@rgcjonas.gmail.com
